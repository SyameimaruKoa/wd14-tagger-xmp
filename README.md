# WD14 Tagger Universal (日本語版)

このツールは、AI (WD14 Tagger) を使用して画像認識を行い、タグ付け・フォルダ整理・レポート作成を行うツールじゃ。

Windows (PowerShell) と Linux (Bash) の両方に対応しておる。

## 特徴

* **3つの実行モード** : 通常実行、推論サーバー、クライアント送信モード。
* **柔軟なアクション** : 「タグ付けだけ」「整理だけ」「レポート作成だけ」など自由に組み合わせ可能。
* **事故防止** : 引数なしで実行しても、環境構築のみを行い、勝手にファイルを書き換えることはない。
* **完全日本語** : ヘルプもログも日本語じゃ。

## 使い方 (Windows / PowerShell)

基本的には `run_tagger.ps1` を使用する。

### 1. 初回セットアップ

引数なしで実行すると、必要な仮想環境を作成して終了する。

このとき、同じフォルダに設定ファイル config.json も生成されるぞ。

```
.\run_tagger.ps1

```

### 2. 基本的な使い方 (タグ付け + レポート)

フォルダまたは画像ファイルを指定して実行する。デフォルトではGPUを使用せずCPUで動く。

```
.\run_tagger.ps1 -Path "C:\Images"

```

GPUを使う場合は `-Gpu` をつける（推奨）。

```
.\run_tagger.ps1 -Path "C:\Images" -Gpu

```

### 3. フォルダ整理のみを行いたい場合

タグ付けはせず、既存のタグ（またはAI判定結果）に基づいてフォルダ振り分けだけを行う。

```
.\run_tagger.ps1 -Path "C:\Images" -Organize

```

※このモードでは、サブフォルダは検索されない（直下のみ）。

### 4. 両方行いたい場合

タグ付けをして、その結果でフォルダ整理もする。

```
.\run_tagger.ps1 -Path "C:\Images" -Tag -Organize

```

### 5. クライアントモード

別のPCでサーバーモード (`-Server`) を起動しておき、そこへ画像を投げる。

```
.\run_tagger.ps1 -Client -HostIP "192.168.1.10" -Path "C:\Images" -Organize

```

## オプション一覧

| **オプション (PS)** | **説明**                                              |
| ------------------------- | ----------------------------------------------------------- |
| `-Path`                 | 処理対象のファイルまたはフォルダ。                          |
| `-Gpu`                  | GPUを使用して高速化する。                                   |
| `-Organize`             | フォルダ整理モードを有効にする（デフォルトでタグ付けOFF）。 |
| `-Tag`                  | タグ付けを有効にする（`-Organize`と併用時に使用）。       |
| `-NoReport`             | HTMLレポートを作成しない。                                  |
| `-Recursive`            | 強制的にサブフォルダも検索する。                            |
| `-NoRecursive`          | 強制的にサブフォルダを検索しない。                          |
| `-Force`                | 既にタグがあっても強制的に再解析・上書きする。              |
| `-Server`               | サーバーモードで起動する。                                  |
| `-Client`               | クライアントモードで起動する。                              |

## 設定ファイル (config.json)

初回実行時に config.json が生成される。

これを書き換えることで、細かい挙動や振り分け先のフォルダ名を自由に変更できるのじゃ。

※アップデート等で新しい設定項目が増えた場合、自動的にファイルに追記されるぞ（既存の設定は消えないので安心せよ）。

### 設定項目一覧

| **項目名 (key)**        | **デフォルト値** | **説明**                                                                                                                                                                                                                       |
| ----------------------------- | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `general_threshold`         | `0.40`               | **General（全年齢）判定の安全弁** 。``AIが「Generalである確率」がこの値以上なら、たとえ他のR指定スコアが高くても強制的に「General」として扱う。``誤爆（安全な画像をR指定にしてしまうこと）を防ぐための設定じゃ。 |
| `sensitive_split_threshold` | `0.50`               | **Sensitive（軽度の性的表現）の強度分け** 。``Sensitiveタグが付いた画像のうち、スコアがこの値未満なら「mild（R-15程度）」、以上なら「high（R-15強）」としてフォルダを分けることができる。                               |
| `server_host`               | `"localhost"`        | サーバーモードやクライアントモードで使うデフォルトのIPアドレス。                                                                                                                                                                     |
| `server_port`               | `5000`               | 通信に使用するポート番号。                                                                                                                                                                                                           |
| `folder_names`              | (下記参照)             | 整理モード (`--organize`) で振り分けられるフォルダ名の設定。                                                                                                                                                                       |

### folder_names (フォルダ名設定)

整理モードで作成されるフォルダの名前を自由に変更できる。

例えば R-18 を Adult に変えたりできるぞ。

| **キー**     | **デフォルトフォルダ名** | **対応するレーティング**     |
| ------------------ | ------------------------------ | ---------------------------------- |
| `general`        | `"R-00"`                     | 全年齢 (Safe)                      |
| `sensitive_mild` | `"R-15_0"`                   | 軽度の際どい画像                   |
| `sensitive_high` | `"R-15_5"`                   | 強めの際どい画像                   |
| `questionable`   | `"R-17"`                     | 露出が多い、または判断が難しい画像 |
| `explicit`       | `"R-18"`                     | 成人向け (Explicit)                |

作成: わっち (Gemini)
